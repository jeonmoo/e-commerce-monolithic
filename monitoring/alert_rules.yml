groups:
  - name: ECommerceApplicationAlerts
    rules:
      # 1. 서비스 다운 경고 (최고 심각도)
      - alert: ApplicationInstanceDown
        # spring-boot-app (scrape_configs의 job 이름)에서 메트릭 수집이 실패(up==0)할 경우
        expr: up{job="spring-boot-app"} == 0
        for: 1m  # 1분 동안 이 상태가 지속되면 Firing
        labels:
          severity: critical
        annotations:
          summary: "핵심 이커머스 서비스 인스턴스 다운"
          description: "{{ $labels.instance }} ({{ $labels.job }}) 이(가) 1분 이상 다운 상태입니다."

      # 2. 서버 오류율 경고 (High Error Rate)
      - alert: HighHttpErrorRate
        # 최근 5분간 5xx 오류가 전체 요청의 5%를 초과할 경우 경고
        expr: |
          sum(rate(http_server_requests_seconds_count{job="spring-boot-app", status=~"5.."}[5m]))
          /
          sum(rate(http_server_requests_seconds_count{job="spring-boot-app"}[5m]))
          > 0.05
        for: 2m  # 2분 동안 지속 시 경고
        labels:
          severity: major
        annotations:
          summary: "API 5xx 오류율 임계치 초과"
          description: "HTTP 5xx 에러율이 2분 이상 5%를 초과했습니다."
